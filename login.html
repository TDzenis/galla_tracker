<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sign In</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.css">
    <style type="text/css">
        body { font: 14px sans-serif; }
        .wrapper { width: 350px; padding: 20px; margin: auto;}
        .help-block { color: red;}
    </style>
</head>
<body>
    <div class="wrapper">
        <h2>Sign In</h2>
        <p>Please fill this to sign in.</p>
        <form  name="signInForm" id="signInForm">
            <div class="form-group">
                <label>Email Address</label>
                <input type="email" name="email" id="email" class="form-control" value="test@test.com" placeholder="Enter email">
                <span class="help-block" id="email_err"></span>
            </div>    
            <div class="form-group">
                <label>Password</label>
                <input type="password" name="password" id="password" class="form-control" value="3\L2C;WKk" placeholder="Password" required>
                <span class="help-block" id="password_err"></span>
            </div>
            <div class="form-group">
                <input class="btn btn-primary" value="Submit" onclick="ValidateData()">
                <input type="reset" class="btn btn-default" value="Reset">
            </div>
            <p>Don't have an account? <a href="/register">Register here</a>.</p>
        </form>
    </div>   

<script>
function ValidateData() {
    const mailFormat = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
    const passwordFormat = /^.*(?=.{8,})((?=.*[!@#$%^&*()\-_=+{};:,<.>]){1})(?=.*\d)((?=.*[a-z]){1})((?=.*[A-Z]){1}).*$/
    const email = document.getElementById("email")
    const email_err = document.getElementById("email_err")
    const password = document.getElementById("password")
    const password_err = document.getElementById("password_err")

    if (email.value.match(mailFormat)) {
        email_err.textContent = "";
    } else {
        email_err.textContent = "You have entered an invalid email address!";
        email.focus();
    }

    if (password.value.match(passwordFormat) && password.value != "") {
        password_err.textContent = "";
        fetch('/logInUser', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                user: {
                    email: email.value,
                    password: password.value
                }
            })
        }).then((res) => {
            return res.json();
        }).then((data => {
            console.log(data);
            if (data.status == "ok") {
                window.location.href = "/main";
            } else {
                console.log(data.error);
                email_err.textContent = data.error;
            }
        }));
    } else {
        password_err.textContent = "Your password does not meet the criteria!";
        password.focus();
    }
}
</script>
</body>
</html>