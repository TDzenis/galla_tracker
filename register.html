<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sign Up</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.css">
    <style type="text/css">
        body { font: 14px sans-serif; }
        .wrapper { width: 350px; padding: 20px; margin: auto;}
        .help-block { color: red;}

    </style>
</head>
<body>
    <div class="wrapper">
        <h2>Sign Up</h2>
        <p>Please fill this form to create an account.</p>
        <form  name="RegistrationForm" id="registrationForm" > <!-- action="/registerUser" method="POST"-->
            <div class="form-group">
                <label>Email Address</label>
                <input type="email" name="email" id="email" class="form-control" value="test@test.com" placeholder="Enter email">
                <span class="help-block" id="email_err"></span>
            </div>    
            <div class="form-group">
                <label>Password</label>
                <input type="password" name="password" id="password" class="form-control" value="3\L2C;WKk" placeholder="Password" required>
            </div>
            <div class="form-group">
                <label>Confirm Password</label>
                <input type="password" name="confirm_password" id="confirm_password" class="form-control" value="3\L2C;WKk" placeholder="Password" required>
                <span class="help-block" id="password_err"></span>
            </div>
            <div class="form-group">
                <input class="btn btn-primary" value="Submit" onclick="ValidateData()">
                <input type="reset" class="btn btn-default" value="Reset">
            </div>
            <p>Already have an account? <a href="/login">Login here</a>.</p>
        </form>
    </div>   

<script>
function ValidateData() {
    const mailFormat = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
    const passwordFormat = /^.*(?=.{8,})((?=.*[!@#$%^&*()\-_=+{};:,<.>]){1})(?=.*\d)((?=.*[a-z]){1})((?=.*[A-Z]){1}).*$/


    if (document.getElementById("email").value.match(mailFormat)) {
        document.getElementById("email_err").textContent = "";
    } else {
        document.getElementById("email_err").textContent = "You have entered an invalid email address!";
        document.getElementById("email").focus();
    }

    if (document.getElementById("password").value.match(passwordFormat) && document.getElementById("password").value != "") {
        document.getElementById("password_err").textContent = "";
        if (document.getElementById("confirm_password").value == document.getElementById("password").value) {
            document.getElementById("password_err").textContent = "";
            
            fetch('/registerUser', {
                method: 'POST',
                redirect: 'follow',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    user: {
                        email: document.getElementById("email").value,
                        password: document.getElementById("password").value
                    }
                })
            }).then((res)=>{
                return res.json();
            }).then((data => {
                console.log(data);
                if (data.status == "ok") {
                    window.location.href = "/login";
                } else {
                    alert(data.error);
                }
            }));
        } else {
            document.getElementById("password_err").textContent = "Your passwords do not match!";
            document.getElementById("confirm_password").focus();
        }
    } else {
        document.getElementById("password_err").textContent = "Your password does not meet the criteria!";
        document.getElementById("password").focus();
    }

    
}
</script>
</body>
</html>